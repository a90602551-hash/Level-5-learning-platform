<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 1 Grammar Worksheet - Level 5A</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/grammar-worksheet.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        /* Brand Color Override */
        .header {
            background: linear-gradient(135deg, #F6E27F 0%, #F6E27F 100%) !important;
            box-shadow: 0 4px 20px rgba(246, 226, 127, 0.3) !important;
        }
        
        .header .logo {
            color: #1F2A44 !important;
            font-weight: 700 !important;
        }
        
        .header .nav-link {
            color: #1F2A44 !important;
        }
        
        .header .student-info {
            color: #1F2A44 !important;
            background: rgba(31, 42, 68, 0.1) !important;
        }
        
        .page-title {
            color: #1F2A44 !important;
        }
        
        /* ë²„íŠ¼ ê°•ì¡° */
        button[onclick*="complete"], .check-answer-btn, button[class*="btn"] {
            font-size: 16px !important;
            padding: 15px 30px !important;
            font-weight: 600 !important;
            border-radius: 8px !important;
        }
        
        button[onclick*="complete"] {
            background: linear-gradient(135deg, #F6E27F 0%, #E5D06B 100%) !important;
            color: #1F2A44 !important;
            border: 3px solid #1F2A44 !important;
            box-shadow: 0 4px 20px rgba(246, 226, 127, 0.4) !important;
        }
        
        /* Pattern Hunting Interactive Styles */
        .interactive-sentence {
            font-size: 18px;
            line-height: 2.5;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            margin: 15px 0;
            user-select: none;
        }
        
        .word {
            display: inline-block;
            padding: 4px 8px;
            margin: 2px;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
            position: relative;
        }
        
        .word:hover {
            background: #e0e7ff;
            transform: translateY(-2px);
        }
        
        .word.selected-parenthesis {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            font-weight: 600;
        }
        
        .word.selected-verb {
            background: #dbeafe;
            border: 2px solid #3b82f6;
            font-weight: 600;
            position: relative;
        }
        
        .word.selected-verb::after {
            content: 'V';
            position: absolute;
            top: -8px;
            right: -8px;
            background: #3b82f6;
            color: white;
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .selection-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .mode-btn {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .mode-btn.active-parenthesis {
            background: #fef3c7;
            border-color: #f59e0b;
            color: #92400e;
        }
        
        .mode-btn.active-verb {
            background: #dbeafe;
            border-color: #3b82f6;
            color: #1e40af;
        }
        
        .reset-btn {
            padding: 8px 16px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .reset-btn:hover {
            background: #dc2626;
        }
        
        .pattern-result {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 12px;
            border: 2px solid #e5e7eb;
        }
        
        .result-label {
            font-weight: 600;
            color: #64748b;
            margin-bottom: 8px;
            display: block;
        }
        
        .result-text {
            font-size: 16px;
            line-height: 1.8;
            color: #1e293b;
        }
        
        .check-answer-btn {
            margin-top: 15px;
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .check-answer-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 12px;
            font-weight: 600;
            display: none;
        }
        
        .feedback.correct {
            background: #d1fae5;
            color: #065f46;
            border: 2px solid #10b981;
            display: block;
        }
        
        .feedback.incorrect {
            background: #fee2e2;
            color: #991b1b;
            border: 2px solid #ef4444;
            display: block;
        }
        
        .instruction-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .instruction-box h3 {
            margin: 0 0 10px 0;
            font-size: 18px;
        }
        
        .instruction-box p {
            margin: 5px 0;
            opacity: 0.95;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
                <span>Level 5 Learning</span>
            </div>
            <nav class="nav">
                <a href="index.html" class="nav-link">
                    <i class="fas fa-home"></i> í™ˆ
                </a>
                <div class="student-info" id="studentInfo">
                    <i class="fas fa-user-circle"></i>
                    <span id="studentName">í•™ìƒ</span>
                </div>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div class="page-header">
                <a href="index.html" class="back-btn">
                    <i class="fas fa-arrow-left"></i> ëŒì•„ê°€ê¸°
                </a>
                <h1 class="page-title">
                    <i class="fas fa-book"></i>
                    [Level 5A-1] Grammar Logic Workbook
                </h1>
                <p class="page-subtitle">Week 1-1. ê´€ê³„ì‚¬ì ˆ ë‚´ ì‚½ì…êµ¬ì¡° (Embedded Clauses)</p>
            </div>

            <!-- Section: Pattern Hunting (Interactive) -->
            <div class="worksheet-section">
                <div class="section-header">
                    <div class="section-number">1</div>
                    <div class="section-title">
                        <h2>Pattern Hunting (ë‹¨ì„œ í¬ì°©) - ì¸í„°ë™í‹°ë¸Œ ë²„ì „</h2>
                        <p class="section-description">
                            ë‹¨ì–´ë¥¼ í´ë¦­í•˜ì—¬ ì‚½ì…ì ˆê³¼ ì§„ì§œ ë™ì‚¬ë¥¼ í‘œì‹œí•˜ì„¸ìš”!
                        </p>
                    </div>
                </div>

                <!-- Instructions -->
                <div class="instruction-box">
                    <h3><i class="fas fa-info-circle"></i> ì‚¬ìš© ë°©ë²•</h3>
                    <p><strong>1ë‹¨ê³„:</strong> ì•„ë˜ ë²„íŠ¼ì—ì„œ <span style="background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 4px;">ê´„í˜¸ ëª¨ë“œ</span> ë˜ëŠ” <span style="background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 4px;">V ëª¨ë“œ</span>ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
                    <p><strong>2ë‹¨ê³„:</strong> ë¬¸ì¥ì˜ ë‹¨ì–´ë¥¼ í´ë¦­í•˜ì—¬ í‘œì‹œí•˜ì„¸ìš”.</p>
                    <p><strong>3ë‹¨ê³„:</strong> ê´„í˜¸ëŠ” ì‚½ì…ì ˆ(ì£¼ì–´+ë™ì‚¬)ì—, VëŠ” ì§„ì§œ ë™ì‚¬ì— í‘œì‹œí•©ë‹ˆë‹¤.</p>
                    <p><strong>4ë‹¨ê³„:</strong> ì™„ë£Œë˜ë©´ "ì •ë‹µ í™•ì¸" ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”!</p>
                </div>

                <!-- Sentence 1 -->
                <div class="pattern-item">
                    <div class="pattern-number">1</div>
                    <div class="pattern-content">
                        <h4 style="margin-bottom: 10px; color: #1e293b;">Sentence 1</h4>
                        
                        <!-- Selection Mode Buttons -->
                        <div class="selection-buttons">
                            <button class="mode-btn" id="mode1-parenthesis" onclick="setMode(1, 'parenthesis')">
                                <i class="fas fa-brackets"></i> ê´„í˜¸ ëª¨ë“œ ( )
                            </button>
                            <button class="mode-btn" id="mode1-verb" onclick="setMode(1, 'verb')">
                                <i class="fas fa-check"></i> V ëª¨ë“œ
                            </button>
                            <button class="reset-btn" onclick="resetSentence(1)">
                                <i class="fas fa-redo"></i> ì´ˆê¸°í™”
                            </button>
                        </div>

                        <!-- Interactive Sentence -->
                        <div class="interactive-sentence" id="sentence1">
                            <span class="word" data-index="0" onclick="toggleWord(1, 0)">The</span>
                            <span class="word" data-index="1" onclick="toggleWord(1, 1)">suspect</span>
                            <span class="word" data-index="2" onclick="toggleWord(1, 2)">who</span>
                            <span class="word" data-index="3" onclick="toggleWord(1, 3)">the</span>
                            <span class="word" data-index="4" onclick="toggleWord(1, 4)">police</span>
                            <span class="word" data-index="5" onclick="toggleWord(1, 5)">thought</span>
                            <span class="word" data-index="6" onclick="toggleWord(1, 6)">was</span>
                            <span class="word" data-index="7" onclick="toggleWord(1, 7)">guilty</span>
                            <span class="word" data-index="8" onclick="toggleWord(1, 8)">has</span>
                            <span class="word" data-index="9" onclick="toggleWord(1, 9)">been</span>
                            <span class="word" data-index="10" onclick="toggleWord(1, 10)">released.</span>
                        </div>

                        <!-- Result Display -->
                        <div class="pattern-result">
                            <span class="result-label">ë‹¹ì‹ ì˜ ë‹µ:</span>
                            <div class="result-text" id="result1">í´ë¦­í•˜ì—¬ ì„ íƒì„ ì‹œì‘í•˜ì„¸ìš”...</div>
                        </div>

                        <button class="check-answer-btn" onclick="checkAnswer(1)">
                            <i class="fas fa-check-circle"></i> ì •ë‹µ í™•ì¸
                        </button>
                        
                        <div class="feedback" id="feedback1"></div>
                    </div>
                </div>

                <!-- Sentence 2 -->
                <div class="pattern-item">
                    <div class="pattern-number">2</div>
                    <div class="pattern-content">
                        <h4 style="margin-bottom: 10px; color: #1e293b;">Sentence 2</h4>
                        
                        <div class="selection-buttons">
                            <button class="mode-btn" id="mode2-parenthesis" onclick="setMode(2, 'parenthesis')">
                                <i class="fas fa-brackets"></i> ê´„í˜¸ ëª¨ë“œ ( )
                            </button>
                            <button class="mode-btn" id="mode2-verb" onclick="setMode(2, 'verb')">
                                <i class="fas fa-check"></i> V ëª¨ë“œ
                            </button>
                            <button class="reset-btn" onclick="resetSentence(2)">
                                <i class="fas fa-redo"></i> ì´ˆê¸°í™”
                            </button>
                        </div>

                        <div class="interactive-sentence" id="sentence2">
                            <span class="word" data-index="0" onclick="toggleWord(2, 0)">We</span>
                            <span class="word" data-index="1" onclick="toggleWord(2, 1)">interviewed</span>
                            <span class="word" data-index="2" onclick="toggleWord(2, 2)">a</span>
                            <span class="word" data-index="3" onclick="toggleWord(2, 3)">candidate</span>
                            <span class="word" data-index="4" onclick="toggleWord(2, 4)">who</span>
                            <span class="word" data-index="5" onclick="toggleWord(2, 5)">we</span>
                            <span class="word" data-index="6" onclick="toggleWord(2, 6)">believed</span>
                            <span class="word" data-index="7" onclick="toggleWord(2, 7)">had</span>
                            <span class="word" data-index="8" onclick="toggleWord(2, 8)">the</span>
                            <span class="word" data-index="9" onclick="toggleWord(2, 9)">most</span>
                            <span class="word" data-index="10" onclick="toggleWord(2, 10)">potential</span>
                            <span class="word" data-index="11" onclick="toggleWord(2, 11)">for</span>
                            <span class="word" data-index="12" onclick="toggleWord(2, 12)">the</span>
                            <span class="word" data-index="13" onclick="toggleWord(2, 13)">role.</span>
                        </div>

                        <div class="pattern-result">
                            <span class="result-label">ë‹¹ì‹ ì˜ ë‹µ:</span>
                            <div class="result-text" id="result2">í´ë¦­í•˜ì—¬ ì„ íƒì„ ì‹œì‘í•˜ì„¸ìš”...</div>
                        </div>

                        <button class="check-answer-btn" onclick="checkAnswer(2)">
                            <i class="fas fa-check-circle"></i> ì •ë‹µ í™•ì¸
                        </button>
                        
                        <div class="feedback" id="feedback2"></div>
                    </div>
                </div>

                <!-- Sentence 3 -->
                <div class="pattern-item">
                    <div class="pattern-number">3</div>
                    <div class="pattern-content">
                        <h4 style="margin-bottom: 10px; color: #1e293b;">Sentence 3</h4>
                        
                        <div class="selection-buttons">
                            <button class="mode-btn" id="mode3-parenthesis" onclick="setMode(3, 'parenthesis')">
                                <i class="fas fa-brackets"></i> ê´„í˜¸ ëª¨ë“œ ( )
                            </button>
                            <button class="mode-btn" id="mode3-verb" onclick="setMode(3, 'verb')">
                                <i class="fas fa-check"></i> V ëª¨ë“œ
                            </button>
                            <button class="reset-btn" onclick="resetSentence(3)">
                                <i class="fas fa-redo"></i> ì´ˆê¸°í™”
                            </button>
                        </div>

                        <div class="interactive-sentence" id="sentence3">
                            <span class="word" data-index="0" onclick="toggleWord(3, 0)">This</span>
                            <span class="word" data-index="1" onclick="toggleWord(3, 1)">is</span>
                            <span class="word" data-index="2" onclick="toggleWord(3, 2)">the</span>
                            <span class="word" data-index="3" onclick="toggleWord(3, 3)">masterpiece</span>
                            <span class="word" data-index="4" onclick="toggleWord(3, 4)">which</span>
                            <span class="word" data-index="5" onclick="toggleWord(3, 5)">the</span>
                            <span class="word" data-index="6" onclick="toggleWord(3, 6)">critics</span>
                            <span class="word" data-index="7" onclick="toggleWord(3, 7)">say</span>
                            <span class="word" data-index="8" onclick="toggleWord(3, 8)">changed</span>
                            <span class="word" data-index="9" onclick="toggleWord(3, 9)">the</span>
                            <span class="word" data-index="10" onclick="toggleWord(3, 10)">history</span>
                            <span class="word" data-index="11" onclick="toggleWord(3, 11)">of</span>
                            <span class="word" data-index="12" onclick="toggleWord(3, 12)">modern</span>
                            <span class="word" data-index="13" onclick="toggleWord(3, 13)">art.</span>
                        </div>

                        <div class="pattern-result">
                            <span class="result-label">ë‹¹ì‹ ì˜ ë‹µ:</span>
                            <div class="result-text" id="result3">í´ë¦­í•˜ì—¬ ì„ íƒì„ ì‹œì‘í•˜ì„¸ìš”...</div>
                        </div>

                        <button class="check-answer-btn" onclick="checkAnswer(3)">
                            <i class="fas fa-check-circle"></i> ì •ë‹µ í™•ì¸
                        </button>
                        
                        <div class="feedback" id="feedback3"></div>
                    </div>
                </div>

                <!-- Next Button to Error Detection -->
                <div style="text-align: center; margin-top: 40px; padding: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px;">
                    <h3 style="color: white; margin-bottom: 15px;">
                        <i class="fas fa-check-circle"></i> Pattern Hunting ì™„ë£Œ!
                    </h3>
                    <p style="color: rgba(255,255,255,0.9); margin-bottom: 20px;">
                        ëª¨ë“  ë¬¸ì œë¥¼ í™•ì¸í•˜ì…¨ë‚˜ìš”? ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™í•˜ì„¸ìš”.
                    </p>
                    <button onclick="goToErrorDetection()" style="background: white; color: #667eea; border: none; padding: 15px 40px; border-radius: 12px; font-size: 18px; font-weight: 600; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                        <i class="fas fa-arrow-right"></i> ë‹¤ìŒ ë‹¨ê³„: Error Detection
                    </button>
                </div>

            </div>

            <!-- Section 2: Logical Error Detection -->
            <div class="worksheet-section" id="errorDetectionSection" style="margin-top: 40px; display: none;">
                <div class="section-header">
                    <div class="section-number">2</div>
                    <div class="section-title">
                        <h2>Logical Error Detection (ì˜¤ë¥˜ ìˆ˜ì • ë° ì„¤ëª…)</h2>
                        <p class="section-description">
                            ë‹¤ìŒ ë¬¸ì¥ì—ì„œ ì–´ë²•ìƒ í‹€ë¦° ë¶€ë¶„ì„ ì°¾ì•„ ê³ ì¹˜ê³ , ê·¸ <strong>[ì‚¬ê³ ê³¼ì •(Logic)]</strong>ì„ ë…¼ë¦¬ì ìœ¼ë¡œ ì„œìˆ í•˜ì„¸ìš”.<br>
                            <span style="color: #667eea;">(ëª…ì‹œì  ë¬¸ë²• ì¸ê°•ì—ì„œ ì„ ìƒë‹˜ì´ ë³´ì—¬ì¤€ ì‚¬ê³ ê³¼ì •ì„ ì°¸ê³ í•˜ì„¸ìš”!)</span>
                        </p>
                    </div>
                </div>

                <!-- Error 1: Sentence A -->
                <div class="pattern-item">
                    <div class="pattern-number">A</div>
                    <div class="pattern-content">
                        <div class="interactive-sentence" style="background: #f8f9fa; border: 2px solid #e5e7eb; font-size: 18px; padding: 20px; margin-bottom: 20px;">
                            "She is the teacher who I heard was won the national award."
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="font-weight: 600; color: #1e293b; display: block; margin-bottom: 8px;">
                                <i class="fas fa-edit"></i> Correction:
                            </label>
                            <input type="text" id="correction1" 
                                   placeholder="ìˆ˜ì •ëœ ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”" 
                                   style="width: 100%; padding: 12px; font-size: 16px; border: 2px solid #e5e7eb; border-radius: 8px;">
                        </div>

                        <div style="background: #f8fafc; padding: 20px; border-radius: 12px; border: 2px solid #e5e7eb;">
                            <h4 style="margin: 0 0 15px 0; color: #1e293b;">
                                <i class="fas fa-brain"></i> Logic (ì‚¬ê³ ê³¼ì •):
                            </h4>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="font-weight: 600; color: #475569; display: block; margin-bottom: 5px;">
                                    (ë‹¨ì„œ í¬ì°©)
                                </label>
                                <textarea id="logic1-clue" rows="2" 
                                          placeholder="ì–´ë–¤ ë‹¨ì„œë¥¼ í¬ì°©í–ˆë‚˜ìš”?"
                                          style="width: 100%; padding: 10px; font-size: 14px; border: 1px solid #cbd5e1; border-radius: 6px; resize: vertical;"></textarea>
                            </div>

                            <div style="margin-bottom: 15px;">
                                <label style="font-weight: 600; color: #475569; display: block; margin-bottom: 5px;">
                                    (êµ¬ì¡° ë¶„ì„)
                                </label>
                                <textarea id="logic1-analysis" rows="2" 
                                          placeholder="ë¬¸ì¥ êµ¬ì¡°ë¥¼ ì–´ë–»ê²Œ ë¶„ì„í–ˆë‚˜ìš”?"
                                          style="width: 100%; padding: 10px; font-size: 14px; border: 1px solid #cbd5e1; border-radius: 6px; resize: vertical;"></textarea>
                            </div>

                            <div style="margin-bottom: 0;">
                                <label style="font-weight: 600; color: #475569; display: block; margin-bottom: 5px;">
                                    (ê²°ë¡  ì ìš©)
                                </label>
                                <textarea id="logic1-conclusion" rows="2" 
                                          placeholder="ì–´ë–¤ ê²°ë¡ ì„ ì ìš©í–ˆë‚˜ìš”?"
                                          style="width: 100%; padding: 10px; font-size: 14px; border: 1px solid #cbd5e1; border-radius: 6px; resize: vertical;"></textarea>
                            </div>
                        </div>

                        <button class="check-answer-btn" onclick="checkLogicalError(1)" style="margin-top: 20px;">
                            <i class="fas fa-check-circle"></i> ì œì¶œ ë° í™•ì¸
                        </button>
                        
                        <div class="feedback" id="feedback-error1"></div>
                    </div>
                </div>

                <!-- Error 2: Sentence B -->
                <div class="pattern-item">
                    <div class="pattern-number">B</div>
                    <div class="pattern-content">
                        <div class="interactive-sentence" style="background: #f8f9fa; border: 2px solid #e5e7eb; font-size: 18px; padding: 20px; margin-bottom: 20px;">
                            "The artifact which the researcher claimed it was authentic proved to be a fake."
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="font-weight: 600; color: #1e293b; display: block; margin-bottom: 8px;">
                                <i class="fas fa-edit"></i> Correction:
                            </label>
                            <input type="text" id="correction2" 
                                   placeholder="ìˆ˜ì •ëœ ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”" 
                                   style="width: 100%; padding: 12px; font-size: 16px; border: 2px solid #e5e7eb; border-radius: 8px;">
                        </div>

                        <div style="background: #f8fafc; padding: 20px; border-radius: 12px; border: 2px solid #e5e7eb;">
                            <h4 style="margin: 0 0 15px 0; color: #1e293b;">
                                <i class="fas fa-brain"></i> Logic (ì‚¬ê³ ê³¼ì •):
                            </h4>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="font-weight: 600; color: #475569; display: block; margin-bottom: 5px;">
                                    (ë‹¨ì„œ í¬ì°©)
                                </label>
                                <textarea id="logic2-clue" rows="2" 
                                          placeholder="ì–´ë–¤ ë‹¨ì„œë¥¼ í¬ì°©í–ˆë‚˜ìš”?"
                                          style="width: 100%; padding: 10px; font-size: 14px; border: 1px solid #cbd5e1; border-radius: 6px; resize: vertical;"></textarea>
                            </div>

                            <div style="margin-bottom: 15px;">
                                <label style="font-weight: 600; color: #475569; display: block; margin-bottom: 5px;">
                                    (êµ¬ì¡° ë¶„ì„)
                                </label>
                                <textarea id="logic2-analysis" rows="2" 
                                          placeholder="ë¬¸ì¥ êµ¬ì¡°ë¥¼ ì–´ë–»ê²Œ ë¶„ì„í–ˆë‚˜ìš”?"
                                          style="width: 100%; padding: 10px; font-size: 14px; border: 1px solid #cbd5e1; border-radius: 6px; resize: vertical;"></textarea>
                            </div>

                            <div style="margin-bottom: 0;">
                                <label style="font-weight: 600; color: #475569; display: block; margin-bottom: 5px;">
                                    (ê²°ë¡  ì ìš©)
                                </label>
                                <textarea id="logic2-conclusion" rows="2" 
                                          placeholder="ì–´ë–¤ ê²°ë¡ ì„ ì ìš©í–ˆë‚˜ìš”?"
                                          style="width: 100%; padding: 10px; font-size: 14px; border: 1px solid #cbd5e1; border-radius: 6px; resize: vertical;"></textarea>
                            </div>
                        </div>

                        <button class="check-answer-btn" onclick="checkLogicalError(2)" style="margin-top: 20px;">
                            <i class="fas fa-check-circle"></i> ì œì¶œ ë° í™•ì¸
                        </button>
                        
                        <div class="feedback" id="feedback-error2"></div>
                    </div>
                </div>

                <!-- Error 3: Sentence C -->
                <div class="pattern-item">
                    <div class="pattern-number">C</div>
                    <div class="pattern-content">
                        <div class="interactive-sentence" style="background: #f8f9fa; border: 2px solid #e5e7eb; font-size: 18px; padding: 20px; margin-bottom: 20px;">
                            "This is the student who the principal believes are the most talented in our school."
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="font-weight: 600; color: #1e293b; display: block; margin-bottom: 8px;">
                                <i class="fas fa-edit"></i> Correction:
                            </label>
                            <input type="text" id="correction3" 
                                   placeholder="ìˆ˜ì •ëœ ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”" 
                                   style="width: 100%; padding: 12px; font-size: 16px; border: 2px solid #e5e7eb; border-radius: 8px;">
                        </div>

                        <div style="background: #f8fafc; padding: 20px; border-radius: 12px; border: 2px solid #e5e7eb;">
                            <h4 style="margin: 0 0 15px 0; color: #1e293b;">
                                <i class="fas fa-brain"></i> Logic (ì‚¬ê³ ê³¼ì •):
                            </h4>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="font-weight: 600; color: #475569; display: block; margin-bottom: 5px;">
                                    (ë‹¨ì„œ í¬ì°©)
                                </label>
                                <textarea id="logic3-clue" rows="2" 
                                          placeholder="ì–´ë–¤ ë‹¨ì„œë¥¼ í¬ì°©í–ˆë‚˜ìš”?"
                                          style="width: 100%; padding: 10px; font-size: 14px; border: 1px solid #cbd5e1; border-radius: 6px; resize: vertical;"></textarea>
                            </div>

                            <div style="margin-bottom: 15px;">
                                <label style="font-weight: 600; color: #475569; display: block; margin-bottom: 5px;">
                                    (êµ¬ì¡° ë¶„ì„)
                                </label>
                                <textarea id="logic3-analysis" rows="2" 
                                          placeholder="ë¬¸ì¥ êµ¬ì¡°ë¥¼ ì–´ë–»ê²Œ ë¶„ì„í–ˆë‚˜ìš”?"
                                          style="width: 100%; padding: 10px; font-size: 14px; border: 1px solid #cbd5e1; border-radius: 6px; resize: vertical;"></textarea>
                            </div>

                            <div style="margin-bottom: 0;">
                                <label style="font-weight: 600; color: #475569; display: block; margin-bottom: 5px;">
                                    (ê²°ë¡  ì ìš©)
                                </label>
                                <textarea id="logic3-conclusion" rows="2" 
                                          placeholder="ì–´ë–¤ ê²°ë¡ ì„ ì ìš©í–ˆë‚˜ìš”?"
                                          style="width: 100%; padding: 10px; font-size: 14px; border: 1px solid #cbd5e1; border-radius: 6px; resize: vertical;"></textarea>
                            </div>
                        </div>

                        <button class="check-answer-btn" onclick="checkLogicalError(3)" style="margin-top: 20px;">
                            <i class="fas fa-check-circle"></i> ì œì¶œ ë° í™•ì¸
                        </button>
                        
                        <div class="feedback" id="feedback-error3"></div>
                    </div>
                </div>

                <!-- Complete Button -->
                <div style="text-align: center; margin-top: 40px; padding: 30px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 12px;">
                    <h3 style="color: white; margin-bottom: 15px;">
                        <i class="fas fa-trophy"></i> ë¬¸ë²• ì›Œí¬ì‹œíŠ¸ ì™„ë£Œ! ğŸ‰
                    </h3>
                    <p style="color: rgba(255,255,255,0.9); margin-bottom: 20px;">
                        ëª¨ë“  ë¬¸ì œë¥¼ ë‹¤ í’€ì—ˆìŠµë‹ˆë‹¤! ìˆ˜ê³ í•˜ì…¨ì–´ìš”!
                    </p>
                    <button onclick="completeGrammarWorksheet()" style="background: white; color: #10b981; border: none; padding: 15px 40px; border-radius: 12px; font-size: 18px; font-weight: 600; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                        <i class="fas fa-arrow-right"></i> ë‹¤ìŒ: Reading í•™ìŠµ
                    </button>
                </div>

            </div>

        </div>
    </main>

    <script src="js/main.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/progress-manager.js"></script>
    
    <script>
        // ========================================
        // Interactive Pattern Hunting Logic
        // ========================================

        // State management
        const sentenceStates = {
            1: { mode: 'parenthesis', parenthesis: [3, 4, 5], verb: [6] },
            2: { mode: 'parenthesis', parenthesis: [5, 6], verb: [7] },
            3: { mode: 'parenthesis', parenthesis: [5, 6, 7], verb: [8] }
        };

        const correctAnswers = {
            1: { parenthesis: [3, 4, 5], verb: [6] }, // "the police thought" / "was"
            2: { parenthesis: [5, 6], verb: [7] },     // "we believed" / "had"
            3: { parenthesis: [5, 6, 7], verb: [8] }   // "the critics say" / "changed"
        };

        const sentences = {
            1: ["The", "suspect", "who", "the", "police", "thought", "was", "guilty", "has", "been", "released."],
            2: ["We", "interviewed", "a", "candidate", "who", "we", "believed", "had", "the", "most", "potential", "for", "the", "role."],
            3: ["This", "is", "the", "masterpiece", "which", "the", "critics", "say", "changed", "the", "history", "of", "modern", "art."]
        };

        // Student's selections
        const studentSelections = {
            1: { parenthesis: [], verb: [] },
            2: { parenthesis: [], verb: [] },
            3: { parenthesis: [], verb: [] }
        };

        // Set selection mode
        function setMode(sentenceNum, mode) {
            sentenceStates[sentenceNum].mode = mode;
            
            // Update button styles
            document.getElementById(`mode${sentenceNum}-parenthesis`).classList.remove('active-parenthesis');
            document.getElementById(`mode${sentenceNum}-verb`).classList.remove('active-verb');
            
            if (mode === 'parenthesis') {
                document.getElementById(`mode${sentenceNum}-parenthesis`).classList.add('active-parenthesis');
            } else {
                document.getElementById(`mode${sentenceNum}-verb`).classList.add('active-verb');
            }
        }

        // Toggle word selection
        function toggleWord(sentenceNum, wordIndex) {
            const mode = sentenceStates[sentenceNum].mode;
            const word = document.querySelector(`#sentence${sentenceNum} .word[data-index="${wordIndex}"]`);
            
            if (mode === 'parenthesis') {
                // Toggle parenthesis selection
                const index = studentSelections[sentenceNum].parenthesis.indexOf(wordIndex);
                if (index > -1) {
                    // Remove selection
                    studentSelections[sentenceNum].parenthesis.splice(index, 1);
                    word.classList.remove('selected-parenthesis');
                } else {
                    // Add selection
                    studentSelections[sentenceNum].parenthesis.push(wordIndex);
                    word.classList.add('selected-parenthesis');
                }
            } else {
                // Toggle verb selection
                const index = studentSelections[sentenceNum].verb.indexOf(wordIndex);
                if (index > -1) {
                    // Remove selection
                    studentSelections[sentenceNum].verb.splice(index, 1);
                    word.classList.remove('selected-verb');
                } else {
                    // Add selection
                    studentSelections[sentenceNum].verb.push(wordIndex);
                    word.classList.add('selected-verb');
                }
            }
            
            updateResultDisplay(sentenceNum);
        }

        // Update result display
        function updateResultDisplay(sentenceNum) {
            const selected = studentSelections[sentenceNum];
            const words = sentences[sentenceNum];
            
            let resultText = '';
            for (let i = 0; i < words.length; i++) {
                let word = words[i];
                
                // Check if word is in parenthesis
                if (selected.parenthesis.includes(i)) {
                    if (resultText.length > 0 && !resultText.endsWith('(')) {
                        resultText += ' ';
                    }
                    if (!resultText.endsWith('(')) {
                        resultText += '(';
                    }
                    resultText += word + ' ';
                } else {
                    // Close parenthesis if needed
                    if (resultText.endsWith(' ') && resultText.includes('(') && !resultText.includes(')')) {
                        resultText = resultText.trim() + ') ';
                    }
                    
                    if (resultText.length > 0 && !resultText.endsWith(' ') && !resultText.endsWith('(')) {
                        resultText += ' ';
                    }
                    resultText += word;
                    
                    // Add V marker if selected as verb
                    if (selected.verb.includes(i)) {
                        resultText += '(V)';
                    }
                }
            }
            
            // Close final parenthesis if needed
            if (resultText.includes('(') && !resultText.includes(')')) {
                resultText = resultText.trim() + ')';
            }
            
            document.getElementById(`result${sentenceNum}`).textContent = resultText || 'í´ë¦­í•˜ì—¬ ì„ íƒì„ ì‹œì‘í•˜ì„¸ìš”...';
        }

        // Reset sentence
        function resetSentence(sentenceNum) {
            // Clear selections
            studentSelections[sentenceNum].parenthesis = [];
            studentSelections[sentenceNum].verb = [];
            
            // Remove all highlighting
            const words = document.querySelectorAll(`#sentence${sentenceNum} .word`);
            words.forEach(word => {
                word.classList.remove('selected-parenthesis', 'selected-verb');
            });
            
            // Reset display
            updateResultDisplay(sentenceNum);
            
            // Hide feedback
            document.getElementById(`feedback${sentenceNum}`).style.display = 'none';
        }

        // Check answer
        function checkAnswer(sentenceNum) {
            const student = studentSelections[sentenceNum];
            const correct = correctAnswers[sentenceNum];
            
            // Sort arrays for comparison
            const studentParenthesis = [...student.parenthesis].sort((a, b) => a - b);
            const correctParenthesis = [...correct.parenthesis].sort((a, b) => a - b);
            const studentVerb = [...student.verb].sort((a, b) => a - b);
            const correctVerb = [...correct.verb].sort((a, b) => a - b);
            
            // Check if correct
            const isParenthesisCorrect = JSON.stringify(studentParenthesis) === JSON.stringify(correctParenthesis);
            const isVerbCorrect = JSON.stringify(studentVerb) === JSON.stringify(correctVerb);
            
            const feedback = document.getElementById(`feedback${sentenceNum}`);
            
            if (isParenthesisCorrect && isVerbCorrect) {
                feedback.className = 'feedback correct';
                feedback.innerHTML = '<i class="fas fa-check-circle"></i> ì •ë‹µì…ë‹ˆë‹¤! í›Œë¥­í•´ìš”! ğŸ‰';
            } else {
                feedback.className = 'feedback incorrect';
                let message = '<i class="fas fa-times-circle"></i> ë‹¤ì‹œ í•œ ë²ˆ í™•ì¸í•´ë³´ì„¸ìš”.<br>';
                
                if (!isParenthesisCorrect) {
                    const correctWords = correctParenthesis.map(i => sentences[sentenceNum][i]);
                    message += `íŒíŠ¸: ê´„í˜¸ëŠ” <strong>${correctWords.join(' ')}</strong>ì— í‘œì‹œí•´ì•¼ í•©ë‹ˆë‹¤.<br>`;
                }
                
                if (!isVerbCorrect) {
                    const correctWords = correctVerb.map(i => sentences[sentenceNum][i]);
                    message += `íŒíŠ¸: VëŠ” <strong>${correctWords.join(', ')}</strong>ì— í‘œì‹œí•´ì•¼ í•©ë‹ˆë‹¤.`;
                }
                
                feedback.innerHTML = message;
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            const student = getCurrentStudent();
            if (student) {
                document.getElementById('studentName').textContent = student.name;
            }
            
            // Set default mode for all sentences
            setMode(1, 'parenthesis');
            setMode(2, 'parenthesis');
            setMode(3, 'parenthesis');
        });

        // ========================================
        // Navigate to Error Detection
        // ========================================
        function goToErrorDetection() {
            // Hide Pattern Hunting section
            document.querySelectorAll('.worksheet-section')[0].style.display = 'none';
            
            // Show Error Detection section
            document.getElementById('errorDetectionSection').style.display = 'block';
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ========================================
        // Error Detection Logic
        // ========================================

        const errorCorrectAnswers = {
            1: {
                correction: "She is the teacher who I heard won the national award.",
                logic: {
                    clue: "ê´€ê³„ëŒ€ëª…ì‚¬ 'who' ë’¤ì— 'ì£¼ì–´+ë™ì‚¬(I heard)' ì‚½ì… êµ¬ì¡°ê°€ ìˆê³ , ì§„ì§œ ë™ì‚¬ëŠ” 'won'ì´ì–´ì•¼ í•¨",
                    analysis: "'was won'ì€ ìˆ˜ë™íƒœì¸ë°, 'win'ì€ íƒ€ë™ì‚¬ì´ë¯€ë¡œ ëŠ¥ë™íƒœ 'won'ì„ ì¨ì•¼ í•¨. ì‚½ì…ì ˆ 'I heard'ë¥¼ ê´„í˜¸ë¡œ ì²˜ë¦¬í•˜ë©´ 'who won'ì´ ë§ìŒ",
                    conclusion: "'was won'ì„ 'won'ìœ¼ë¡œ ìˆ˜ì •"
                }
            },
            2: {
                correction: "The artifact which the researcher claimed was authentic proved to be a fake.",
                logic: {
                    clue: "ê´€ê³„ëŒ€ëª…ì‚¬ 'which'ê°€ ì´ë¯¸ ì£¼ì–´ ì—­í• ì„ í•¨. 'the researcher claimed'ëŠ” ì‚½ì…ì ˆ",
                    analysis: "'which'ê°€ ì£¼ì–´ì¸ë° 'it was'ì—ì„œ 'it'ê°€ ë˜ ì£¼ì–´ë¡œ ë‚˜íƒ€ë‚˜ ì¤‘ë³µë¨. ì‚½ì…ì ˆì„ ê´„í˜¸ë¡œ ì²˜ë¦¬í•˜ë©´ 'which was authentic'ê°€ ë˜ì–´ì•¼ í•¨",
                    conclusion: "'it'ë¥¼ ì œê±°í•˜ì—¬ 'which the researcher claimed was authentic'ë¡œ ìˆ˜ì •"
                }
            },
            3: {
                correction: "This is the student who the principal believes is the most talented in our school.",
                logic: {
                    clue: "ê´€ê³„ëŒ€ëª…ì‚¬ 'who'ì˜ ì„ í–‰ì‚¬ëŠ” 'the student' (ë‹¨ìˆ˜)",
                    analysis: "'the principal believes'ëŠ” ì‚½ì…ì ˆì´ê³ , ì§„ì§œ ë™ì‚¬ëŠ” 'are'ì¸ë° ì„ í–‰ì‚¬ê°€ ë‹¨ìˆ˜ì´ë¯€ë¡œ 'is'ë¥¼ ì¨ì•¼ í•¨",
                    conclusion: "'are'ë¥¼ 'is'ë¡œ ìˆ˜ì •"
                }
            }
        };

        function checkLogicalError(num) {
            const correction = document.getElementById(`correction${num}`).value.trim();
            const clue = document.getElementById(`logic${num}-clue`).value.trim();
            const analysis = document.getElementById(`logic${num}-analysis`).value.trim();
            const conclusion = document.getElementById(`logic${num}-conclusion`).value.trim();
            
            const feedback = document.getElementById(`feedback-error${num}`);
            
            // Check if all fields are filled
            if (!correction || !clue || !analysis || !conclusion) {
                feedback.className = 'feedback incorrect';
                feedback.innerHTML = '<i class="fas fa-exclamation-circle"></i> ëª¨ë“  í•­ëª©ì„ ì‘ì„±í•´ì£¼ì„¸ìš”!';
                feedback.style.display = 'block';
                return;
            }
            
            // Check correction
            const correctCorrection = errorCorrectAnswers[num].correction;
            const isCorrect = correction.toLowerCase().replace(/[.,!?]/g, '').trim() === 
                             correctCorrection.toLowerCase().replace(/[.,!?]/g, '').trim();
            
            // Provide feedback
            feedback.className = 'feedback ' + (isCorrect ? 'correct' : 'incorrect');
            feedback.style.display = 'block';
            
            let feedbackHTML = '';
            
            if (isCorrect) {
                feedbackHTML = '<i class="fas fa-check-circle"></i> <strong>Correction ì •ë‹µì…ë‹ˆë‹¤!</strong> ğŸ‰<br><br>';
            } else {
                feedbackHTML = '<i class="fas fa-times-circle"></i> <strong>Correctionì´ ì •í™•í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</strong><br>';
                feedbackHTML += `<strong>ëª¨ë²”ë‹µì•ˆ:</strong> ${correctCorrection}<br><br>`;
            }
            
            // Show model logic
            feedbackHTML += '<div style="background: white; padding: 15px; border-radius: 8px; margin-top: 15px;">';
            feedbackHTML += '<h4 style="margin: 0 0 10px 0; color: #1e293b;"><i class="fas fa-lightbulb"></i> ëª¨ë²” ì‚¬ê³ ê³¼ì •:</h4>';
            feedbackHTML += `<p style="margin: 8px 0;"><strong>(ë‹¨ì„œ í¬ì°©)</strong><br>${errorCorrectAnswers[num].logic.clue}</p>`;
            feedbackHTML += `<p style="margin: 8px 0;"><strong>(êµ¬ì¡° ë¶„ì„)</strong><br>${errorCorrectAnswers[num].logic.analysis}</p>`;
            feedbackHTML += `<p style="margin: 8px 0;"><strong>(ê²°ë¡  ì ìš©)</strong><br>${errorCorrectAnswers[num].logic.conclusion}</p>`;
            feedbackHTML += '</div>';
            
            // Compare student logic with model
            feedbackHTML += '<div style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin-top: 15px; border: 2px solid #3b82f6;">';
            feedbackHTML += '<h4 style="margin: 0 0 10px 0; color: #1e40af;"><i class="fas fa-user"></i> ë‹¹ì‹ ì˜ ì‚¬ê³ ê³¼ì •:</h4>';
            feedbackHTML += `<p style="margin: 8px 0;"><strong>(ë‹¨ì„œ í¬ì°©)</strong><br>${clue}</p>`;
            feedbackHTML += `<p style="margin: 8px 0;"><strong>(êµ¬ì¡° ë¶„ì„)</strong><br>${analysis}</p>`;
            feedbackHTML += `<p style="margin: 8px 0;"><strong>(ê²°ë¡  ì ìš©)</strong><br>${conclusion}</p>`;
            feedbackHTML += '</div>';
            
            feedback.innerHTML = feedbackHTML;
        }

        // ========================================
        // Firebase Progress Save
        // ========================================
        
        async function completeGrammarWorksheet() {
            try {
                // Get student info from localStorage
                const studentId = localStorage.getItem('studentId');
                const studentName = localStorage.getItem('studentName');
                
                if (!studentId) {
                    alert('ë¡œê·¸ì¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                    window.location.href = 'index.html';
                    return;
                }
                
                // Check if ProgressManager is available
                if (typeof ProgressManager === 'undefined') {
                    console.warn('ProgressManager not available, completing without saving');
                    window.location.href = 'reading-day1-final.html';
                    return;
                }
                
                // Save to Firebase
                await ProgressManager.updateActivity(studentId, 1, 'grammar', true);
                
                alert('âœ… ë¬¸ë²• ì›Œí¬ì‹œíŠ¸ ì™„ë£Œ!\n\në‹¤ìŒ ë‹¨ê³„ì¸ Readingìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                window.location.href = 'reading-day1-final.html';
                
            } catch (error) {
                console.error('ì™„ë£Œ ì €ì¥ ì¤‘ ì˜¤ë¥˜:', error);
                // Even if save fails, allow navigation
                alert('ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nReadingìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                window.location.href = 'reading-day1-final.html';
            }
        }
    </script>
</body>
</html>
